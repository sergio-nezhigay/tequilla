{%- assign section_id = section.id -%}

<section
  id="{{ section_id }}"
  class="tequila-process-section {{ section.settings.custom_classes }}"
  style="background-color: {{ section.settings.outer_background_color | default: '#F9F6F2' }};"
>
  <div
    class="tequila-process-background"
    style="max-width: {{ section.settings.max_width }}px; margin-left: auto; margin-right: auto;"
  >
    <div class="tequila-process-container">
      {%- if section.settings.main_title != blank -%}
        <div class="tequila-process-header">
          <h2 class="main-title">{{ section.settings.main_title }}</h2>
          {%- if section.settings.subtitle != blank -%}
            <p class="subtitle">{{ section.settings.subtitle }}</p>
          {%- endif -%}
        </div>
      {%- endif -%}

      <div class="tequila-process-steps">
        {%- for block in section.blocks -%}
          {%- assign is_reverse = block.settings.reverse_layout -%}
          <div class="process-step {{ block.type }}" {{ block.shopify_attributes }}>
            <div class="step-content {% if is_reverse %}step-reverse{% endif %}">
              <div class="step-image">
                {%- if block.settings.image_desktop != blank or block.settings.image_mobile != blank -%}
                  <picture>
                    {%- if block.settings.image_mobile != blank -%}
                      <source
                        media="(max-width: 768px)"
                        srcset="
                          {{ block.settings.image_mobile | image_url: width: 350 }} 350w,
                          {{ block.settings.image_mobile | image_url: width: 700 }} 700w
                        "
                        sizes="(max-width: 390px) 320px, 350px"
                      >
                    {%- endif -%}
                    {%- if block.settings.image_desktop != blank -%}
                      <source
                        media="(min-width: 769px)"
                        srcset="
                          {{ block.settings.image_desktop | image_url: width: 400 }} 400w,
                          {{ block.settings.image_desktop | image_url: width: 600 }} 600w,
                          {{ block.settings.image_desktop | image_url: width: 800 }} 800w
                        "
                        sizes="(max-width: 1200px) 350px, 400px"
                      >
                    {%- endif -%}
                    {%- assign main_image = block.settings.image_desktop | default: block.settings.image_mobile -%}
                    {%- if main_image != blank -%}
                      {{
                        main_image
                        | image_url: width: 800
                        | image_tag:
                          alt: block.settings.image_alt,
                          loading: 'lazy',
                          width: main_image.width,
                          height: main_image.height
                      }}
                    {%- endif -%}
                  </picture>
                {%- endif -%}
              </div>

              <div class="step-text">
                <div class="step-number">{{ block.settings.step_number }}</div>
                {%- if block.settings.step_title != blank -%}
                  <h3 class="step-title">{{ block.settings.step_title }}</h3>
                {%- endif -%}
                {%- if block.settings.step_description != blank -%}
                  <div class="step-description">{{ block.settings.step_description }}</div>
                {%- endif -%}
              </div>
            </div>
          </div>
        {%- endfor -%}
      </div>

      {%- if section.settings.cta_text != blank -%}
        <div class="tequila-process-cta">
          <a href="{{ section.settings.cta_url | default: '#' }}" class="button-cta">
            {{ section.settings.cta_text }}
          </a>
        </div>
      {%- endif -%}
    </div>
  </div>
</section>

<style>
  #{{ section_id }} {
    --section-padding-top-mobile: {{ section.settings.padding_top_mobile }}px;
    --section-padding-bottom-mobile: {{ section.settings.padding_bottom_mobile }}px;
    --section-padding-top-desktop: {{ section.settings.padding_top_desktop }}px;
    --section-padding-bottom-desktop: {{ section.settings.padding_bottom_desktop }}px;
    --section-bg-color: {{ section.settings.background_color }};
    --main-title-color: {{ section.settings.main_title_color }};
    --main-title-size-mobile: {{ section.settings.main_title_size_mobile }}px;
    --main-title-size-desktop: {{ section.settings.main_title_size_desktop }}px;
    --subtitle-color: {{ section.settings.subtitle_color }};
    --subtitle-size-mobile: {{ section.settings.subtitle_size_mobile }}px;
    --subtitle-size-desktop: {{ section.settings.subtitle_size_desktop }}px;
    --step-title-color: {{ section.settings.step_title_color }};
    --step-title-size-mobile: {{ section.settings.step_title_size_mobile }}px;
    --step-title-size-desktop: {{ section.settings.step_title_size_desktop }}px;
    --step-number-color: {{ section.settings.step_number_color }};
    --step-description-color: {{ section.settings.step_description_color }};
    --cta-bg-color: {{ section.settings.cta_bg_color }};
    --cta-text-color: {{ section.settings.cta_text_color }};
    --max-width: {{ section.settings.max_width }}px;
    --step-strong-color: #67B7A8;

    padding-top: var(--section-padding-top-mobile);
    padding-bottom: var(--section-padding-bottom-mobile);
    position: relative;
    background-color: {{ section.settings.outer_background_color | default: '#F9F6F2' }};
  }

  #{{ section_id }}.tequila-process-section {
      padding-left: 10px;
      padding-right: 10px;
  }

  #{{ section_id }} .tequila-process-background {
    background-color: var(--section-bg-color);
    border-radius: 20px;
    padding: 30px 10px 40px;
    max-width: var(--max-width);
    margin-left: auto;
    margin-right: auto;
    position: relative;
    overflow: hidden;
  }

  #{{ section_id }} .tequila-process-background::before {
    content: '';
    position: absolute;
    top: 15px;
    left: 50px;
    right: 38px;
    bottom: 0px;
    background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTM0IiBoZWlnaHQ9IjEyMyIgdmlld0JveD0iMCAwIDEzNCAxMjMiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMzQiIGhlaWdodD0iMTIzIiBmaWxsPSJyZ2JhKDAsIDAsIDAsIDAuMDUpIiBzdHJva2U9InJnYmEoMCwgMCwgMCwgMC4xKSIgc3Ryb2tlLXdpZHRoPSIxIi8+Cjwvc3ZnPgo=');
    background-size: 144px 133px;
    background-repeat: repeat;
    z-index: 1;
    pointer-events: none;
    opacity: 0.3;
    border-radius: calc(20px - 3px);
  }

  #{{ section_id }} .tequila-process-background::before {
    {% if section.settings.bg_pattern_image != blank %}
      background-image: url('{{ section.settings.bg_pattern_image | image_url: width: 134, height: 123 }}');
    {% endif %}
    opacity: {{ section.settings.bg_pattern_opacity | divided_by: 100.0 }};
  }

  #{{ section_id }} .tequila-process-container {
    /* max-width: var(--max-width); */
    /* margin: 0 auto; */
    padding-left: 0;
    padding-right: 0;
    margin-left: auto;
    margin-right: auto;
    position: relative;
    z-index: 2;
  }

  /* Base (mobile-first) styles */
  #{{ section_id }} .tequila-process-header {
    text-align: center;
    margin-bottom: 10px;
  }

  #{{ section_id }} .main-title {
    font-size: var(--main-title-size-mobile);
    color: var(--main-title-color);
    font-weight: bold;
    margin: 0 0 10px 0;
    line-height: 1.2;
    text-transform: uppercase;
  }

  #{{ section_id }} .subtitle {
    font-size: var(--subtitle-size-mobile);
    font-weight: 400;
    color: var(--subtitle-color);
    margin: 0;
    line-height: 1.65;
  }

  #{{ section_id }} .tequila-process-steps {
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  #{{ section_id }} .process-step {
    position: relative;
  }

  #{{ section_id }} .step-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0;
  }

  #{{ section_id }} .step-image {
    width: 100%;
    max-width: 400px;
    overflow: hidden;
    position: relative;
    margin-bottom: 5px;
  }

  #{{ section_id }} .step-image img {
    width: 100%;
    height: auto;
    display: block;
    object-fit: cover;
  }

  #{{ section_id }} .step-text {
    text-align: left;
    flex: 1;
    max-width: 100%;
  }

  #{{ section_id }} .step-number {
    font-size: 50px;
    font-weight: bold;
    color: var(--step-number-color);
    margin-bottom: 0px;
    line-height: 1;
    font-family: Futura Hv BT, Roundo, sans-serif;
  }

  #{{ section_id }} .step-title {
    font-size: var(--step-title-size-mobile);
    color: var(--step-title-color);
    font-weight: normal;
    margin: 0 0 10px 0;
    line-height: 1.2;
    text-transform: uppercase;
  }

  #{{ section_id }} .step-description {
    font-size: 18px;
    font-weight: 300;
    color: var(--step-description-color);
    opacity: 0.8;
    line-height: 1.65;
    letter-spacing: 0;
    margin: 0;
  }

  #{{ section_id }} .tequila-process-cta {
    text-align: center;
    margin-top: 20px;
  }

  /* Rich text styling for different colors */
  #{{ section_id }} .step-description p {
    margin: 0 0 12px 0;
  }

  #{{ section_id }} .step-description p:last-child {
    margin-bottom: 0;
  }

  #{{ section_id }} strong {
    color: var(--step-strong-color);
    font-weight: normal;
  }

  #{{ section_id }} em {
    color: var(--main-title-color);
    font-style: italic;
  }

  /* Tablet (768px - 1024px) */
  @media screen and (min-width: 768px) and (max-width: 1024px) {
    #{{ section_id }} .step-image {
      max-width: 260px;
    }
  }

  /* Desktop (>=769px) - consolidated */
  @media screen and (min-width: 769px) {
    #{{ section_id }} {
      padding-top: var(--section-padding-top-desktop);
      padding-bottom: var(--section-padding-bottom-desktop);
    }

    #{{ section_id }}.tequila-process-section {
      padding-left: 112px;
      padding-right: 112px;
    }

    #{{ section_id }} .tequila-process-background {
      border-radius: 30px;
      /* larger horizontal padding on wide screens; will be overridden by larger breakpoints if needed */
      padding: 50px 10px 51px;
      padding-top: var(--section-padding-top-desktop);
      padding-bottom: var(--section-padding-bottom-desktop);
    }

    #{{ section_id }} .tequila-process-container {
      padding-left: 0;
      padding-right: 0;
      margin-left: auto;
      margin-right: auto;
    }

    #{{ section_id }} .main-title {
      font-size: var(--main-title-size-desktop);
    }

    #{{ section_id }} .subtitle {
      font-size: var(--subtitle-size-desktop);
    }

    #{{ section_id }} .tequila-process-header {
      margin-bottom: 30px;
    }

    #{{ section_id }} .tequila-process-steps {
      gap: 50px;
    }

    #{{ section_id }} .step-content {
      flex-direction: row;
      gap: 20px;
      align-items: flex-end;
    }

    #{{ section_id }} .step-content.step-reverse {
      flex-direction: row-reverse;
    }

    #{{ section_id }} .step-text {
      text-align: left;
      max-width: none;
    }

    #{{ section_id }} .step-content.step-reverse .step-text {
      text-align: right;
    }

    #{{ section_id }} .step-title {
      font-size: var(--step-title-size-desktop);
      line-height: 1;
      margin-bottom: 12px;
      max-width: 364px;
    }

    #{{ section_id }} .step-reverse .step-title {
      margin-left: auto;
    }

    #{{ section_id }} .step-description {
      font-size: 20px;
    }

    #{{ section_id }} .step-number {
      font-size: 80px;
      line-height: 1;
    }

    #{{ section_id }} .tequila-process-cta {
      margin-top: 30px;
    }

    #{{ section_id }} .button-cta {
      padding-left: 80px;
      padding-right: 80px;
    }
  }

  /* Large desktops (>=1200px) */
  @media screen and (min-width: 1200px) {
    #{{ section_id }} .step-content {
      gap: 20px;
    }

    #{{ section_id }} .step-image {
      max-width: 392px;
    }

    #{{ section_id }} .tequila-process-background {
      padding: 50px 103px 51px;
    }
  }
</style>

{% schema %}
{
  "name": "Tequila Process Steps",
  "settings": [
    {
      "type": "richtext",
      "id": "main_title",
      "label": "Main Title",
      "default": "<p><strong>Create</strong> a Tequila to <em>be remembered</em></p>"
    },
    {
      "type": "text",
      "id": "subtitle",
      "label": "Subtitle",
      "default": "The Tequila making process"
    },
    {
      "type": "header",
      "content": "Title Styling"
    },
    {
      "type": "color",
      "id": "main_title_color",
      "label": "Main Title Color",
      "default": "#2c2c2c"
    },
    {
      "type": "range",
      "id": "main_title_size_mobile",
      "label": "Main Title Size (Mobile)",
      "min": 20,
      "max": 50,
      "step": 2,
      "default": 24,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "main_title_size_desktop",
      "label": "Main Title Size (Desktop)",
      "min": 24,
      "max": 60,
      "step": 2,
      "default": 36,
      "unit": "px"
    },
    {
      "type": "color",
      "id": "subtitle_color",
      "label": "Subtitle Color",
      "default": "#666666"
    },
    {
      "type": "range",
      "id": "subtitle_size_mobile",
      "label": "Subtitle Size (Mobile)",
      "min": 14,
      "max": 24,
      "step": 1,
      "default": 16,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "subtitle_size_desktop",
      "label": "Subtitle Size (Desktop)",
      "min": 16,
      "max": 28,
      "step": 1,
      "default": 18,
      "unit": "px"
    },
    {
      "type": "header",
      "content": "Step Styling"
    },
    {
      "type": "color",
      "id": "step_number_color",
      "label": "Step Number Color",
      "default": "#7ECBC0"
    },
    {
      "type": "color",
      "id": "step_title_color",
      "label": "Step Title Color",
      "default": "#2c2c2c"
    },
    {
      "type": "range",
      "id": "step_title_size_mobile",
      "label": "Step Title Size (Mobile)",
      "min": 18,
      "max": 36,
      "step": 2,
      "default": 22,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "step_title_size_desktop",
      "label": "Step Title Size (Desktop)",
      "min": 20,
      "max": 40,
      "step": 2,
      "default": 28,
      "unit": "px"
    },
    {
      "type": "color",
      "id": "step_description_color",
      "label": "Step Description Color",
      "default": "#666666"
    },
    {
      "type": "header",
      "content": "Call to Action"
    },
    {
      "type": "text",
      "id": "cta_text",
      "label": "CTA Button Text",
      "default": "CREATE YOUR OWN TEQUILA"
    },
    {
      "type": "url",
      "id": "cta_url",
      "label": "CTA Button URL"
    },
    {
      "type": "color",
      "id": "cta_bg_color",
      "label": "CTA Background Color",
      "default": "#7ECBC0"
    },
    {
      "type": "color",
      "id": "cta_text_color",
      "label": "CTA Text Color",
      "default": "#2c2c2c"
    },
    {
      "type": "header",
      "content": "Section Settings"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#F5D5C8"
    },
    {
      "type": "image_picker",
      "id": "bg_pattern_image",
      "label": "Background Pattern Image (134x123px recommended)"
    },
    {
      "type": "range",
      "id": "bg_pattern_opacity",
      "label": "Background Pattern Opacity",
      "min": 0,
      "max": 100,
      "step": 5,
      "default": 30,
      "unit": "%"
    },
    {
      "type": "number",
      "id": "max_width",
      "label": "Max Width",
      "default": 1200
    },
    {
      "type": "range",
      "id": "padding_top_mobile",
      "label": "Padding Top (Mobile)",
      "min": 0,
      "max": 100,
      "step": 5,
      "default": 40,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "padding_bottom_mobile",
      "label": "Padding Bottom (Mobile)",
      "min": 0,
      "max": 100,
      "step": 5,
      "default": 40,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "padding_top_desktop",
      "label": "Padding Top (Desktop)",
      "min": 0,
      "max": 150,
      "step": 10,
      "default": 80,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "padding_bottom_desktop",
      "label": "Padding Bottom (Desktop)",
      "min": 0,
      "max": 150,
      "step": 10,
      "default": 80,
      "unit": "px"
    },
    {
      "type": "text",
      "id": "custom_classes",
      "label": "Custom CSS Classes"
    },
    {
      "type": "color",
      "id": "outer_background_color",
      "label": "Outer Background Color",
      "default": "#F9F6F2"
    }
  ],
  "blocks": [
    {
      "type": "process_step",
      "name": "Process Step",
      "settings": [
        {
          "type": "text",
          "id": "step_number",
          "label": "Step Number",
          "default": "1."
        },
        {
          "type": "richtext",
          "id": "step_title",
          "label": "Step Title",
          "default": "<p>AGAVES AGED TO PERFECTION</p>"
        },
        {
          "type": "richtext",
          "id": "step_description",
          "label": "Step Description",
          "default": "<p>Only mature Blue Weber Agaves - at least 8 years old - are harvested for our tequila. This long maturation period ensures the optimal balance of natural sugars that define exceptional flavor.</p>"
        },
        {
          "type": "image_picker",
          "id": "image_desktop",
          "label": "Desktop Image"
        },
        {
          "type": "image_picker",
          "id": "image_mobile",
          "label": "Mobile Image"
        },
        {
          "type": "text",
          "id": "image_alt",
          "label": "Image Alt Text"
        },
        {
          "type": "checkbox",
          "id": "reverse_layout",
          "label": "Reverse Layout (Desktop)",
          "default": false
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Tequila Process Steps",
      "blocks": [
        {
          "type": "process_step",
          "settings": {
            "step_number": "1.",
            "step_title": "<p>AGAVES AGED TO PERFECTION</p>",
            "step_description": "<p>Only mature Blue Weber Agaves - at least 8 years old - are harvested for our tequila. This long maturation period ensures the optimal balance of natural sugars that define exceptional flavor.</p>"
          }
        },
        {
          "type": "process_step",
          "settings": {
            "step_number": "2.",
            "step_title": "<p>SLOW COOKING THE OLD WAY</p>",
            "step_description": "<p>Agaves are slowly cooked for 48-72 hours in traditional ovens. This gentle process preserves the natural flavors of the agave, extracting maximum sweetness without bitter notes.</p>",
            "reverse_layout": true
          }
        },
        {
          "type": "process_step",
          "settings": {
            "step_number": "3.",
            "step_title": "<p>NATURAL MILLING & FERMENTATION</p>",
            "step_description": "<p>Once cooked, the agaves go through a 2-step milling process before being naturally fermented with traditional yeast. We use no artificial additives during this process to maintain purity and tradition.</p>"
          }
        },
        {
          "type": "process_step",
          "settings": {
            "step_number": "4.",
            "step_title": "<p>DOUBLE DISTILLED FOR CLARITY</p>",
            "step_description": "<p>The final distillate is put through two distillation rounds - distilling to excellence ensures purity flavor with the distinctively smooth taste that sets our tequila apart.</p>",
            "reverse_layout": true
          }
        }
      ]
    }
  ]
}
{% endschema %}
